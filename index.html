<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Information Radiator</title>

  <!-- React and ReactDOM (classic) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

  <!-- D3.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            slideUp: 'slideUp 0.8s ease-out forwards',
            pulse: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            glow: 'glow 3s ease-in-out infinite alternate',
          },
          keyframes: {
            slideUp: {
              '0%': { opacity: 0, transform: 'translateY(30px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' }
            },
            glow: {
              '0%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.5)' },
              '100%': { boxShadow: '0 0 30px rgba(59, 130, 246, 0.8)' }
            }
          }
        }
      }
    };
  </script>
</head>

<body class="bg-gray-900 min-h-screen">
  <!-- Animated background pattern -->
  <div class="fixed inset-0 bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 opacity-50"></div>
  <div class="fixed inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
  
  <div id="root" class="relative z-10"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Radiator = () => {
      const [issues, setIssues] = useState([]);
      const [commits, setCommits] = useState([]);
      const [ideas, setIdeas] = useState([]);

      const repo = 'slu-csci-5030/dads';

      const fetchGitHubData = async () => {
        try {
          const [issueRes, commitRes] = await Promise.all([
            fetch(`https://api.github.com/repos/${repo}/issues?state=all`),
            fetch(`https://api.github.com/repos/${repo}/commits`)
          ]);

          // Filter out pull requests (which have the pull_request field)
          const allIssues = await issueRes.json();
          const filteredIssues = allIssues.filter(issue => !issue.pull_request);

          setIssues(filteredIssues);
          setCommits(await commitRes.json());
        } catch (error) {
          console.error('Error fetching GitHub data:', error);
        }
      };

      useEffect(() => {
        fetchGitHubData();
        const interval = setInterval(fetchGitHubData, 30000);
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        if (!issues.length) return;

        const sprintEnd = new Date('2025-06-13T23:59:59Z');
        const today = new Date();
        const startDate = today < sprintEnd ? today : sprintEnd;
        const dayCount = Math.ceil((sprintEnd - startDate) / (1000 * 60 * 60 * 24)) + 1;

        // Current number of open issues (today)
        const currentRemaining = issues.filter(i => i.state === 'open').length;

        // Generate linearly decreasing data from currentRemaining to 0
        const data = [];
        for (let i = 0; i < dayCount; i++) {
          const remaining = Math.max(0, currentRemaining * (1 - i / (dayCount - 1)));
          data.push({ day: i + 1, remaining });
        }

        const maxRemaining = currentRemaining;

        const svg = d3.select('#burndown-chart').html('').attr('width', 400).attr('height', 200);

        const x = d3.scaleLinear().domain([1, dayCount]).range([40, 370]);
        const y = d3.scaleLinear().domain([0, maxRemaining]).range([150, 10]);

        const line = d3.line()
          .x(d => x(d.day))
          .y(d => y(d.remaining))
          .curve(d3.curveMonotoneX);

        // Grid lines
        svg.append('g')
          .attr('class', 'grid')
          .attr('transform', 'translate(0,150)')
          .call(d3.axisBottom(x).ticks(dayCount).tickSize(-140).tickFormat(''))
          .selectAll('line')
          .style('stroke', '#374151')
          .style('stroke-opacity', 0.3);

        svg.append('g')
          .attr('class', 'grid')
          .attr('transform', 'translate(40,0)')
          .call(d3.axisLeft(y).tickSize(-330).tickFormat(''))
          .selectAll('line')
          .style('stroke', '#374151')
          .style('stroke-opacity', 0.3);

        // Axes
        svg.append('g')
          .attr('transform', 'translate(0,150)')
          .call(d3.axisBottom(x).ticks(dayCount).tickFormat(d => `Day ${d}`))
          .selectAll("text")
            .style("text-anchor", "middle")
            .style("fill", "#e5e7eb")
            .attr("transform", "rotate(0)");

        svg.append('g')
          .attr('transform', 'translate(40,0)')
          .call(d3.axisLeft(y))
          .selectAll("text")
            .style("fill", "#e5e7eb");

        // Area under curve
        const area = d3.area()
          .x(d => x(d.day))
          .y0(150)
          .y1(d => y(d.remaining))
          .curve(d3.curveMonotoneX);

        svg.append('path')
          .datum(data)
          .attr('fill', 'url(#gradient)')
          .attr('d', area);

        // Gradient definition
        const defs = svg.append('defs');
        const gradient = defs.append('linearGradient')
          .attr('id', 'gradient')
          .attr('gradientUnits', 'userSpaceOnUse')
          .attr('x1', 0).attr('y1', 10)
          .attr('x2', 0).attr('y2', 150);

        gradient.append('stop')
          .attr('offset', '0%')
          .attr('stop-color', '#60a5fa')
          .attr('stop-opacity', 0.8);

        gradient.append('stop')
          .attr('offset', '100%')
          .attr('stop-color', '#3b82f6')
          .attr('stop-opacity', 0.1);

        // Line
        svg.append('path')
          .datum(data)
          .attr('fill', 'none')
          .attr('stroke', '#60a5fa')
          .attr('stroke-width', 3)
          .attr('d', line);

        // Data points
        svg.selectAll('.dot')
          .data(data)
          .enter().append('circle')
          .attr('class', 'dot')
          .attr('cx', d => x(d.day))
          .attr('cy', d => y(d.remaining))
          .attr('r', 4)
          .attr('fill', '#60a5fa')
          .attr('stroke', '#1e40af')
          .attr('stroke-width', 2);

        // Labels
        svg.append("text")
          .attr("x", 200)
          .attr("y", 190)
          .attr("text-anchor", "middle")
          .attr("font-size", "12px")
          .attr("fill", "#e5e7eb")
          .text("Days");

        svg.append("text")
          .attr("x", -100)
          .attr("y", 15)
          .attr("transform", "rotate(-90)")
          .attr("text-anchor", "middle")
          .attr("font-size", "12px")
          .attr("fill", "#e5e7eb")
          .text("Remaining Open Issues");

      }, [issues]);

      const handleIdeaSubmit = (e) => {
        e.preventDefault();
        const idea = e.target.idea.value.trim();
        if (idea) setIdeas([...ideas, idea]);
        e.target.reset();
      };

      const cards = [
        {
          title: "Sprint Burndown",
          icon: "üìä",
          content: <svg id="burndown-chart" className="w-full h-48"></svg>,
          gradient: "from-blue-600 to-blue-800"
        },
        {
          title: "Issue Tracker",
          icon: "üéØ",
          content: (
            <div className="space-y-4">
              <div className="flex justify-between items-center">
                <span className="text-gray-300">Open Issues</span>
                <span className="text-2xl font-bold text-red-400">{issues.filter(i => i.state === 'open').length}</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-gray-300">Closed Issues</span>
                <span className="text-2xl font-bold text-green-400">{issues.filter(i => i.state === 'closed').length}</span>
              </div>
              <div className="w-full bg-gray-700 rounded-full h-3">
                <div 
                  className="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500"
                  style={{
                    width: `${issues.length > 0 ? (issues.filter(i => i.state === 'closed').length / issues.length) * 100 : 0}%`
                  }}
                ></div>
              </div>
            </div>
          ),
          gradient: "from-emerald-600 to-teal-700"
        },
        {
          title: "Innovation Hub",
          icon: "üí°",
          content: (
            <div className="space-y-3">
              <form onSubmit={handleIdeaSubmit} className="space-y-2">
                <input
                  type="text"
                  name="idea"
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                  placeholder="Share your brilliant idea..."
                />
                <button 
                  type="submit" 
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105"
                >
                  ‚ú® Submit Idea
                </button>
              </form>
              <div className="max-h-32 overflow-y-auto space-y-2 scrollbar-thin scrollbar-thumb-gray-600">
                {ideas.map((idea, index) => (
                  <div key={index} className="bg-gray-700 p-2 rounded text-sm text-gray-200 border-l-4 border-purple-500">
                    {idea}
                  </div>
                ))}
              </div>
            </div>
          ),
          gradient: "from-purple-600 to-pink-600"
        },
        {
          title: "Team Vitals",
          icon: "‚ù§Ô∏è",
          content: (
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <span className="text-gray-300">Status</span>
                <div className="flex items-center space-x-2">
                  <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                  <span className="text-green-400 font-bold">Healthy</span>
                </div>
              </div>
              <div className="text-sm text-gray-400 bg-gray-800 p-3 rounded-lg border-l-4 border-green-400">
                Team performance based on commit frequency and issue resolution velocity
              </div>
              <div className="grid grid-cols-3 gap-2 text-center">
                <div className="bg-gray-800 p-2 rounded">
                  <div className="text-lg font-bold text-blue-400">95%</div>
                  <div className="text-xs text-gray-400">Uptime</div>
                </div>
                <div className="bg-gray-800 p-2 rounded">
                  <div className="text-lg font-bold text-yellow-400">4.8</div>
                  <div className="text-xs text-gray-400">Rating</div>
                </div>
                <div className="bg-gray-800 p-2 rounded">
                  <div className="text-lg font-bold text-green-400">Good</div>
                  <div className="text-xs text-gray-400">Mood</div>
                </div>
              </div>
            </div>
          ),
          gradient: "from-green-600 to-emerald-700"
        },
        {
          title: "Development Metrics",
          icon: "üöÄ",
          content: (
            <div className="space-y-4">
              <div className="flex justify-between items-center">
                <span className="text-gray-300">This Week</span>
                <span className="text-2xl font-bold text-blue-400">{commits.length}</span>
              </div>
              <div className="text-sm text-gray-400">commits pushed</div>
              
              <div className="flex justify-between items-center mt-4">
                <span className="text-gray-300">Milestones</span>
                <span className="text-xl font-bold text-yellow-400">3/5</span>
              </div>
              <div className="w-full bg-gray-700 rounded-full h-2">
                <div className="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full w-3/5"></div>
              </div>
              <div className="text-xs text-gray-400 text-right">60% Complete</div>
            </div>
          ),
          gradient: "from-orange-600 to-red-600"
        }
      ];

      return (
        <div className="min-h-screen p-6">
          {/* Header */}
          <div className="text-center mb-12 animate-slideUp">
            <h1 className="text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
              Team Command Center
            </h1>
            <div className="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto rounded-full"></div>
            <p className="text-gray-400 mt-4 text-lg">Real-time insights into your team's performance</p>
          </div>

          {/* Cards Grid */}
          <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 max-w-7xl mx-auto">
            {cards.map((card, idx) => (
              <div
                key={idx}
                className="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-gray-800 to-gray-900 p-6 shadow-xl border border-gray-700 hover:border-gray-600 transition-all duration-500 transform hover:-translate-y-2 animate-slideUp"
                style={{ animationDelay: `${idx * 0.1}s` }}
              >
                {/* Gradient overlay */}
                <div className={`absolute inset-0 bg-gradient-to-br ${card.gradient} opacity-0 group-hover:opacity-10 transition-opacity duration-300`}></div>
                
                {/* Glow effect */}
                <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl blur opacity-0 group-hover:opacity-30 transition-opacity duration-300"></div>
                
                <div className="relative z-10">
                  {/* Header */}
                  <div className="flex items-center space-x-3 mb-6">
                    <span className="text-2xl">{card.icon}</span>
                    <h2 className="text-xl font-bold text-white group-hover:text-blue-300 transition-colors">
                      {card.title}
                    </h2>
                  </div>
                  
                  {/* Content */}
                  <div className="text-gray-300">
                    {card.content}
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          {/* Footer */}
          <div className="text-center mt-12 text-gray-500">
            <div className="flex items-center justify-center space-x-2">
              <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span>Live updates every 30 seconds</span>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<Radiator />, document.getElementById("root"));
  </script>
</body>
</html>